<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/7835419622e5afa0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7835419622e5afa0.css" data-n-g=""/><link rel="preload" href="/_next/static/css/50425c9106578cba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/50425c9106578cba.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-5020794388548d5e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9cd66785574873e8.js" defer=""></script><script src="/_next/static/chunks/175675d1-7de8b3bfdcedb0f1.js" defer=""></script><script src="/_next/static/chunks/9f96d65d-c9e0543547ce45e9.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-c0ab723d8d52e6df.js" defer=""></script><script src="/_next/static/GE5VJAVhc-vx7NUryvwvV/_buildManifest.js" defer=""></script><script src="/_next/static/GE5VJAVhc-vx7NUryvwvV/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="mainLayout_out__ZYqWw" style="height:calc(100vh - var(--vh-offset, 0px))"><div class="mainLayout_mainarea__QxaY0"><div class="post_post__ejhnw"><div class="post_top__JuBkM"><div class="post_b__Bj3sV"><img alt="back" src="/_next/static/media/back.f6d17d78.png" width="480" height="480" decoding="async" data-nimg="1" class="post_bi__9ghX8" loading="lazy" style="color:transparent"/></div><div class="post_tit__Xu2qi">Webpack 搭建 React + TS 环境<img alt="open" src="/_next/static/media/down.9feac32f.png" width="480" height="480" decoding="async" data-nimg="1" class="post_iconSmall__5Hxz8" loading="lazy" style="color:transparent"/></div><div class="post_b__Bj3sV"><img alt="close" src="/_next/static/media/close.315313d8.png" width="480" height="480" decoding="async" data-nimg="1" class="post_bi__9ghX8" loading="lazy" style="color:transparent"/></div></div><div class="post_mdWarpper__Brjcd"><div class="markdown-body post_md__a6C1y"><h1 id="webpack-基础配置">Webpack 基础配置</h1>
<h2 id="初始化安装依赖">初始化，安装依赖</h2>
<p>最终得到：
<code>package.json</code></p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;webpack&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;main&quot;: &quot;src/main.tsx&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;webpack --config webpack.prod.js&quot;,
    &quot;dev&quot;: &quot;webpack serve --open --config webpack.dev.js&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@babel/core&quot;: &quot;^7.18.2&quot;,
    &quot;@babel/preset-env&quot;: &quot;^7.18.2&quot;,
    &quot;babel-loader&quot;: &quot;^8.2.5&quot;,
    &quot;clean-webpack-plugin&quot;: &quot;^4.0.0&quot;,
    &quot;css-loader&quot;: &quot;^6.7.1&quot;,
    &quot;html-webpack-plugin&quot;: &quot;^5.5.0&quot;,
    &quot;mini-css-extract-plugin&quot;: &quot;^2.6.0&quot;,
    &quot;ts-loader&quot;: &quot;^9.3.0&quot;,
    &quot;typescript&quot;: &quot;^4.7.2&quot;,
    &quot;webpack&quot;: &quot;^5.72.1&quot;,
    &quot;webpack-cli&quot;: &quot;^4.9.2&quot;,
    &quot;webpack-dev-server&quot;: &quot;^4.9.0&quot;,
    &quot;webpack-merge&quot;: &quot;^5.8.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@types/react&quot;: &quot;^18.0.9&quot;,
    &quot;@types/react-dom&quot;: &quot;^18.0.5&quot;,
    &quot;react&quot;: &quot;^18.1.0&quot;,
    &quot;react-dom&quot;: &quot;^18.1.0&quot;
  }
}
</code></pre>
<h2 id="编写-webpackcommonjs-作为主要配置文件">编写 <code>webpack.common.js</code> 作为主要配置文件</h2>
<pre><code class="language-js">const path = require(&#x27;path&#x27;);
const HtmlWebpackPlugin = require(&quot;html-webpack-plugin&quot;);
const {CleanWebpackPlugin} = require(&quot;clean-webpack-plugin&quot;);
const MiniCssExtractPlugin = require(&quot;mini-css-extract-plugin&quot;);

// 生成随机字符串，用于区分打包产物
const bundle_random_str = Math.random().toString(36).slice(-6);

module.exports = {
    // 入口
    entry: {
        index: &#x27;./src/main.tsx&#x27;
    },
    // 出口
    output: {
        path: path.resolve(__dirname, &#x27;./dist&#x27;),
        filename: `assets/[name].${bundle_random_str}.bundle.js`,
    },
    // 对于各个模块的规则
    module: {
        rules: [
            // JavaScript
            {
                test: /\.m?js$/,
                exclude: /node_modules/,
                use: {
                    loader: &#x27;babel-loader&#x27;,
                    options: {
                        presets: [&#x27;@babel/preset-env&#x27;],
                    },
                },
            },
            // css
            {
                test: /\.css$/,
                use: [MiniCssExtractPlugin.loader, &#x27;css-loader&#x27;]
            },
            // ts
            {
                test: /\.tsx?$/,
                use: &#x27;ts-loader&#x27;,
                exclude: /node_modules/,
            },
        ]
    },
    plugins: [
        // 打包前清理
        new CleanWebpackPlugin(),
        // 打包时处理HTML
        new HtmlWebpackPlugin({
            title: &#x27;Webpack Test&#x27;,
            template: path.resolve(__dirname, &#x27;./public/index.html&#x27;),
            filename: &#x27;index.html&#x27;,
        }),
        // 打包成css
        new MiniCssExtractPlugin({
            filename: `assets/style.${bundle_random_str}.css`
        }),
    ],
    resolve: {
        extensions: [&#x27;.js&#x27;, &#x27;.jsx&#x27;, &#x27;.ts&#x27;, &#x27;.tsx&#x27;]
    }
}
</code></pre>
<h3 id="在index中引入-webpack-变量的方法">在index中引入 Webpack 变量的方法</h3>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

</code></pre>
<h2 id="编写开发环境配置文件">编写开发环境配置文件</h2>
<p><code>webpack.dev.js</code></p>
<pre><code class="language-js">const {merge} = require(&#x27;webpack-merge&#x27;);
const common = require(&#x27;./webpack.common.js&#x27;);
const path = require(&quot;path&quot;);

module.exports = merge(common, {
    mode: &#x27;development&#x27;,
    devtool: &#x27;inline-source-map&#x27;,
    // 启用devServer
    devServer: {
        static: {
            publicPath: path.join(__dirname, &#x27;public&#x27;)
        },
        hot: true,
        compress: true,
        port: 3000,
    },
});

</code></pre>
<h2 id="编写生产环境配置文件">编写生产环境配置文件</h2>
<p><code>webpack.prod.js</code></p>
<pre><code class="language-js">const {merge} = require(&#x27;webpack-merge&#x27;);
const common = require(&#x27;./webpack.common.js&#x27;);

module.exports = merge(common, {
    mode: &#x27;production&#x27;,
});

</code></pre>
<h1 id="配置-ts-babel">配置 TS Babel</h1>
<h2 id="配置ts">配置TS</h2>
<p><code>tsconfig.json</code></p>
<pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;outDir&quot;: &quot;./dist/&quot;,
    // &quot;rootDir&quot;: &quot;./src&quot;,
    &quot;sourceMap&quot;: true, // 开启sourcemap
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;target&quot;: &quot;es5&quot;,
    &quot;jsx&quot;: &quot;react&quot;,
    &quot;esModuleInterop&quot;: true,
    &quot;allowJs&quot;: false,
    &quot;strict&quot;: true
  }
}

</code></pre>
<h2 id="配置-babel">配置 Babel</h2>
<p><code>babel.config.json</code></p>
<pre><code class="language-json">{
    &quot;presets&quot;: [&quot;@babel/preset-env&quot;]
}
</code></pre></div></div></div></div><div class="mainLayout_bottom__As9s_"><div class="mainLayout_tag__Ep3_f"><img alt="launcher" src="/_next/static/media/launcher.d8f01379.png" width="1024" height="1024" decoding="async" data-nimg="1" class="mainLayout_tagImg__qoDJq" loading="lazy" style="color:transparent"/></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":"---\nlayout:     post\ntitle:      Webpack 搭建 React + TS 环境\nintro:   \"\"\ndate:       2022-5-29 18:30:00\nauthor:     \"Mahiru\"\ncatalog: true\ntags:\n    - 工程开发\n---\n\n# Webpack 基础配置\n\n## 初始化，安装依赖\n最终得到：\n`package.json`\n```json\n{\n  \"name\": \"webpack\",\n  \"version\": \"1.0.0\",\n  \"main\": \"src/main.tsx\",\n  \"license\": \"MIT\",\n  \"scripts\": {\n    \"build\": \"webpack --config webpack.prod.js\",\n    \"dev\": \"webpack serve --open --config webpack.dev.js\"\n  },\n  \"devDependencies\": {\n    \"@babel/core\": \"^7.18.2\",\n    \"@babel/preset-env\": \"^7.18.2\",\n    \"babel-loader\": \"^8.2.5\",\n    \"clean-webpack-plugin\": \"^4.0.0\",\n    \"css-loader\": \"^6.7.1\",\n    \"html-webpack-plugin\": \"^5.5.0\",\n    \"mini-css-extract-plugin\": \"^2.6.0\",\n    \"ts-loader\": \"^9.3.0\",\n    \"typescript\": \"^4.7.2\",\n    \"webpack\": \"^5.72.1\",\n    \"webpack-cli\": \"^4.9.2\",\n    \"webpack-dev-server\": \"^4.9.0\",\n    \"webpack-merge\": \"^5.8.0\"\n  },\n  \"dependencies\": {\n    \"@types/react\": \"^18.0.9\",\n    \"@types/react-dom\": \"^18.0.5\",\n    \"react\": \"^18.1.0\",\n    \"react-dom\": \"^18.1.0\"\n  }\n}\n```\n\n## 编写 `webpack.common.js` 作为主要配置文件\n```js\nconst path = require('path');\nconst HtmlWebpackPlugin = require(\"html-webpack-plugin\");\nconst {CleanWebpackPlugin} = require(\"clean-webpack-plugin\");\nconst MiniCssExtractPlugin = require(\"mini-css-extract-plugin\");\n\n// 生成随机字符串，用于区分打包产物\nconst bundle_random_str = Math.random().toString(36).slice(-6);\n\nmodule.exports = {\n    // 入口\n    entry: {\n        index: './src/main.tsx'\n    },\n    // 出口\n    output: {\n        path: path.resolve(__dirname, './dist'),\n        filename: `assets/[name].${bundle_random_str}.bundle.js`,\n    },\n    // 对于各个模块的规则\n    module: {\n        rules: [\n            // JavaScript\n            {\n                test: /\\.m?js$/,\n                exclude: /node_modules/,\n                use: {\n                    loader: 'babel-loader',\n                    options: {\n                        presets: ['@babel/preset-env'],\n                    },\n                },\n            },\n            // css\n            {\n                test: /\\.css$/,\n                use: [MiniCssExtractPlugin.loader, 'css-loader']\n            },\n            // ts\n            {\n                test: /\\.tsx?$/,\n                use: 'ts-loader',\n                exclude: /node_modules/,\n            },\n        ]\n    },\n    plugins: [\n        // 打包前清理\n        new CleanWebpackPlugin(),\n        // 打包时处理HTML\n        new HtmlWebpackPlugin({\n            title: 'Webpack Test',\n            template: path.resolve(__dirname, './public/index.html'),\n            filename: 'index.html',\n        }),\n        // 打包成css\n        new MiniCssExtractPlugin({\n            filename: `assets/style.${bundle_random_str}.css`\n        }),\n    ],\n    resolve: {\n        extensions: ['.js', '.jsx', '.ts', '.tsx']\n    }\n}\n```\n\n### 在index中引入 Webpack 变量的方法\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n    \u003cmeta charset=\"UTF-8\"\u003e\n    \u003ctitle\u003e\u003c%= htmlWebpackPlugin.options.title %\u003e\u003c/title\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cdiv id=\"root\"\u003e\u003c/div\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n\n```\n\n## 编写开发环境配置文件\n`webpack.dev.js`\n\n```js\nconst {merge} = require('webpack-merge');\nconst common = require('./webpack.common.js');\nconst path = require(\"path\");\n\nmodule.exports = merge(common, {\n    mode: 'development',\n    devtool: 'inline-source-map',\n    // 启用devServer\n    devServer: {\n        static: {\n            publicPath: path.join(__dirname, 'public')\n        },\n        hot: true,\n        compress: true,\n        port: 3000,\n    },\n});\n\n```\n\n## 编写生产环境配置文件\n`webpack.prod.js`\n```js\nconst {merge} = require('webpack-merge');\nconst common = require('./webpack.common.js');\n\nmodule.exports = merge(common, {\n    mode: 'production',\n});\n\n```\n\n# 配置 TS Babel\n\n## 配置TS\n`tsconfig.json`\n```json\n{\n  \"compilerOptions\": {\n    \"outDir\": \"./dist/\",\n    // \"rootDir\": \"./src\",\n    \"sourceMap\": true, // 开启sourcemap\n    \"module\": \"commonjs\",\n    \"target\": \"es5\",\n    \"jsx\": \"react\",\n    \"esModuleInterop\": true,\n    \"allowJs\": false,\n    \"strict\": true\n  }\n}\n\n```\n\n## 配置 Babel\n`babel.config.json`\n```json\n{\n    \"presets\": [\"@babel/preset-env\"]\n}\n```"},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"2022-5-29-Webpack.markdown"},"buildId":"GE5VJAVhc-vx7NUryvwvV","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>