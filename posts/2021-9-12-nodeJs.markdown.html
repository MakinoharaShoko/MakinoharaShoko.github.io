<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/7835419622e5afa0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7835419622e5afa0.css" data-n-g=""/><link rel="preload" href="/_next/static/css/50425c9106578cba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/50425c9106578cba.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-5020794388548d5e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9cd66785574873e8.js" defer=""></script><script src="/_next/static/chunks/175675d1-7de8b3bfdcedb0f1.js" defer=""></script><script src="/_next/static/chunks/9f96d65d-c9e0543547ce45e9.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-c0ab723d8d52e6df.js" defer=""></script><script src="/_next/static/FSHNphORtj5MGrig2uX3c/_buildManifest.js" defer=""></script><script src="/_next/static/FSHNphORtj5MGrig2uX3c/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="mainLayout_out__ZYqWw" style="height:calc(100vh - var(--vh-offset, 0px))"><div class="mainLayout_mainarea__QxaY0"><div class="post_post__ejhnw"><div class="post_top__JuBkM"><div class="post_b__Bj3sV"><img alt="back" src="/_next/static/media/back.f6d17d78.png" width="480" height="480" decoding="async" data-nimg="1" class="post_bi__9ghX8" loading="lazy" style="color:transparent"/></div><div class="post_tit__Xu2qi">Node.js<img alt="open" src="/_next/static/media/down.9feac32f.png" width="480" height="480" decoding="async" data-nimg="1" class="post_iconSmall__5Hxz8" loading="lazy" style="color:transparent"/></div><div class="post_b__Bj3sV"><img alt="close" src="/_next/static/media/close.315313d8.png" width="480" height="480" decoding="async" data-nimg="1" class="post_bi__9ghX8" loading="lazy" style="color:transparent"/></div></div><div class="post_mdWarpper__Brjcd"><div class="markdown-body post_md__a6C1y"><h2 id="nodejs-服务端开发">Node.js 服务端开发</h2>
<h3 id="使用express搭建基础服务器并处理请求">使用express搭建基础服务器并处理请求</h3>
<pre><code class="language-javascript">//initialize
const Port = 3000;//设置端口号，一般是3000
const express = require(&#x27;express&#x27;);
const { fstat } = require(&#x27;fs&#x27;);
const app = express();
process.env.PORT = Port;
app.use(express.static(&#x27;public&#x27;))//allow browser access resources

//err catch
process.on(&#x27;uncaughtException&#x27;,function(err){}) //监听未捕获的异常
process.on(&#x27;unhandledRejection&#x27;,function(err,promise){}) //监听Promise没有被捕获的失败函数

//传送文件的方法
app.get(&#x27;/borrow&#x27;, (req, res) =&gt; {
  res.setHeader(&#x27;Content-Type&#x27;,&#x27;text/html&#x27;);
  res.sendFile(&#x27;public/borrow/borrow.html&#x27;,{ root : __dirname});
  //由于sendFile要求使用绝对地址，所以要将根目录设置为当前文件夹
})

app.listen(Port, () =&gt; console.log(&#x27;服务器已就绪，运行在端口&#x27;+Port))//输出服务器启动信息
</code></pre>
<h3 id="基本的请求处理方式以数据库为例">基本的请求处理方式（以数据库为例）：</h3>
<pre><code class="language-javascript">//database
const mysql = require(&#x27;mysql&#x27;);
let databaseConnection = mysql.createConnection({
  host: &#x27;localhost&#x27;,
  user: &#x27;root&#x27;,
  password: &#x27;123456&#x27;,
  database: &#x27;books&#x27;,
  port: 3306
});
databaseConnection.connect();

app.get(&#x27;/userinfo/*&#x27;, (req, res) =&gt; {
  let info = req.url;
  let infoS = info.split(&#x27;/&#x27;);
  let user = infoS[2];

  let returnUser;
  let userSelect = &#x27;SELECT name from users where ID = &#x27; + user;
  databaseConnection.query(userSelect, function (error, results, fields) {
    if (error) throw error;
    returnUser = results[0].name;
    res.send(returnUser);
  });

})
</code></pre>
<p>处理表单，返回token：</p>
<pre><code class="language-js">app.post(&#x27;/test_postForm&#x27;, function (req, res) {
  let receivedForm = req.body;
  console.log(&#x27;表单已获取&#x27;);
  let token = receivedForm[&#x27;user_name&#x27;];
  let resUrl = &#x27;/userMain?token=&#x27;+token;
  res.redirect(resUrl);
});
</code></pre></div></div></div></div><div class="mainLayout_bottom__As9s_"><div class="mainLayout_tag__Ep3_f"><img alt="launcher" src="/_next/static/media/launcher.d8f01379.png" width="1024" height="1024" decoding="async" data-nimg="1" class="mainLayout_tagImg__qoDJq" loading="lazy" style="color:transparent"/></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":"---\nlayout:     post\ntitle:      Node.js\nintro:   \"\"\ndate:       2021-9-12 12:00:01\nauthor:     \"Makinohara\"\ncatalog: true\ntags:\n    - 工程开发\n    \n---\n\n## Node.js 服务端开发\n\n### 使用express搭建基础服务器并处理请求\n\n```javascript\n//initialize\nconst Port = 3000;//设置端口号，一般是3000\nconst express = require('express');\nconst { fstat } = require('fs');\nconst app = express();\nprocess.env.PORT = Port;\napp.use(express.static('public'))//allow browser access resources\n\n//err catch\nprocess.on('uncaughtException',function(err){}) //监听未捕获的异常\nprocess.on('unhandledRejection',function(err,promise){}) //监听Promise没有被捕获的失败函数\n\n//传送文件的方法\napp.get('/borrow', (req, res) =\u003e {\n  res.setHeader('Content-Type','text/html');\n  res.sendFile('public/borrow/borrow.html',{ root : __dirname});\n  //由于sendFile要求使用绝对地址，所以要将根目录设置为当前文件夹\n})\n\napp.listen(Port, () =\u003e console.log('服务器已就绪，运行在端口'+Port))//输出服务器启动信息\n```\n\n### 基本的请求处理方式（以数据库为例）：\n\n```javascript\n//database\nconst mysql = require('mysql');\nlet databaseConnection = mysql.createConnection({\n  host: 'localhost',\n  user: 'root',\n  password: '123456',\n  database: 'books',\n  port: 3306\n});\ndatabaseConnection.connect();\n\napp.get('/userinfo/*', (req, res) =\u003e {\n  let info = req.url;\n  let infoS = info.split('/');\n  let user = infoS[2];\n\n  let returnUser;\n  let userSelect = 'SELECT name from users where ID = ' + user;\n  databaseConnection.query(userSelect, function (error, results, fields) {\n    if (error) throw error;\n    returnUser = results[0].name;\n    res.send(returnUser);\n  });\n\n})\n```\n\n处理表单，返回token：\n\n```js\napp.post('/test_postForm', function (req, res) {\n  let receivedForm = req.body;\n  console.log('表单已获取');\n  let token = receivedForm['user_name'];\n  let resUrl = '/userMain?token='+token;\n  res.redirect(resUrl);\n});\n```\n\n"},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"2021-9-12-nodeJs.markdown"},"buildId":"FSHNphORtj5MGrig2uX3c","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>