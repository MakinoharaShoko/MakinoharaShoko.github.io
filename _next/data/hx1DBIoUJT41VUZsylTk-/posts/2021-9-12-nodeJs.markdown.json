{"pageProps":{"post":"---\nlayout:     post\ntitle:      Node.js\nintro:   \"\"\ndate:       2021-9-12 12:00:01\nauthor:     \"Makinohara\"\ncatalog: true\ntags:\n    - 工程开发\n    \n---\n\n## Node.js 服务端开发\n\n### 使用express搭建基础服务器并处理请求\n\n```javascript\n//initialize\nconst Port = 3000;//设置端口号，一般是3000\nconst express = require('express');\nconst { fstat } = require('fs');\nconst app = express();\nprocess.env.PORT = Port;\napp.use(express.static('public'))//allow browser access resources\n\n//err catch\nprocess.on('uncaughtException',function(err){}) //监听未捕获的异常\nprocess.on('unhandledRejection',function(err,promise){}) //监听Promise没有被捕获的失败函数\n\n//传送文件的方法\napp.get('/borrow', (req, res) => {\n  res.setHeader('Content-Type','text/html');\n  res.sendFile('public/borrow/borrow.html',{ root : __dirname});\n  //由于sendFile要求使用绝对地址，所以要将根目录设置为当前文件夹\n})\n\napp.listen(Port, () => console.log('服务器已就绪，运行在端口'+Port))//输出服务器启动信息\n```\n\n### 基本的请求处理方式（以数据库为例）：\n\n```javascript\n//database\nconst mysql = require('mysql');\nlet databaseConnection = mysql.createConnection({\n  host: 'localhost',\n  user: 'root',\n  password: '123456',\n  database: 'books',\n  port: 3306\n});\ndatabaseConnection.connect();\n\napp.get('/userinfo/*', (req, res) => {\n  let info = req.url;\n  let infoS = info.split('/');\n  let user = infoS[2];\n\n  let returnUser;\n  let userSelect = 'SELECT name from users where ID = ' + user;\n  databaseConnection.query(userSelect, function (error, results, fields) {\n    if (error) throw error;\n    returnUser = results[0].name;\n    res.send(returnUser);\n  });\n\n})\n```\n\n处理表单，返回token：\n\n```js\napp.post('/test_postForm', function (req, res) {\n  let receivedForm = req.body;\n  console.log('表单已获取');\n  let token = receivedForm['user_name'];\n  let resUrl = '/userMain?token='+token;\n  res.redirect(resUrl);\n});\n```\n\n"},"__N_SSG":true}