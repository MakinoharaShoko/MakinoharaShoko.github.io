<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mahiru's Humble Abode</title>
    
<link rel="stylesheet" href="/css/osx.css">

    
<link rel="stylesheet" href="/css/aside.css">

    
<link rel="stylesheet" href="/css/index.css">

    
<link rel="stylesheet" href="/css/post.css">

    
<link rel="stylesheet" href="/css/tags.css">

    
<link rel="stylesheet" href="/css/highlight.css">

    <!-- 这是引入样式-->


    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>




<meta name="generator" content="Hexo 4.2.0"></head>




<body >

<div class="Finder">
    &nbsp; &nbsp;

<!--    <img src="/img/title-logo_s.png"  alt="apple" id="Apple"/>-->
    <a href="/" id="logo-text" class="FinderText">&nbsp Mahiru's Humble Abode &nbsp</a>
    <span>
        &nbsp;&nbsp;
    </span>
    <a  href="/" id="blog" class="FinderText">&nbsp博&nbsp&nbsp客&nbsp
<!--        <div id="blogMenu" class="MenuDiv">-->
<!--            <div id="mainpage" class="menuText" >-->
<!--             <a href="/" class="post-url">主页</a>-->
<!--            </div>-->
<!--            <div id="catagory"class="menuText">-->
<!--                <a href="/tags/生活感想" class="post-url">归档</a>-->
<!--            </div>-->
<!--            <div id="archieves" class="menuText">-->
<!--                <a href="/archives" class="post-url">时间线</a>-->
<!--            </div>-->
<!--            <div id="photo" class="menuText">-->
<!--                <a href="/photos" class="post-url">照片墙</a>-->
<!--            </div>-->
<!--        </div>-->
    </a>
    <a href="/archives/2019/08/" id="timeline" class="FinderText">&nbsp时&nbsp间&nbsp线&nbsp</a>
    <a href="/tags/计算机基础" id="cate" class="FinderText">&nbsp归&nbsp&nbsp档&nbsp</a>
    <a href="/aboutNew" id="about" class="FinderText">&nbsp关&nbsp于&nbsp与&nbsp友&nbsp链</a>
<!--    <div id="control" class="FinderText">&nbsp控制&nbsp-->
<!--        <div id="controlMenu"class="MenuDiv">-->
<!--            <div id="backToTop" class="menuText">-->
<!--                <a href="#Showtags" class="post-url">返回顶部</a>-->
<!--            </div>-->
<!--            <div  class="menuText">-->
<!--                <a href="-->
<!--        http://msfasr.com/2022/05/29/2022-5-29-Webpack/-->
<!--        " class="post-url">上一篇-->
<!--                    </a>-->
<!--            </div>-->
<!--            <div  class="menuText">-->
<!--                <a href="-->
<!--        http://msfasr.com/2022/05/25/2022-5-25-Install-MySQL-By-Cli/-->
<!--        " class="post-url">下一篇</a>-->
<!--            </div>-->


<!--        </div></div>-->
<!--    <div id="options" class="FinderText">&nbsp选项&nbsp-->
<!--        <div id="optionsMenu"class="MenuDiv">-->
<!--            <div id="share" class="menuText">-->
<!--                <a href="" class="post-url" id="shareThisPage">分享本页</a>-->
<!--            </div>-->

<!--        </div></div>-->
<!--    <div id="about" class="FinderText">&nbsp关于&nbsp-->
<!--        <div id="aboutMenu"class="MenuDiv">-->

<!--            <div id="aboutMain" class="menuText">-->
<!--                <a href="/2019/08/20/About/" class="post-url">个人简介</a>-->
<!--            </div>-->
<!--            <div  class="menuText">-->
<!--                <a href="/2019/08/20/links/" class="post-url">友情链接</a>-->
<!--            </div>-->

<!--            <div  class="menuText">-->
<!--                <a href="mailto:makinoharashoko@outlook.com" class="post-url">邮箱</a>-->
<!--            </div>-->
<!--            <div  class="menuText">-->
<!--                <a href="https://github.com/MakinoharaShoko" target="_blank" rel="noopener" class="post-url">Github</a>-->
<!--            </div>-->
<!--            <div id="twitter"  class="menuText">-->
<!--                <a href="https://twitter.com/_Makinohara" target="_blank" rel="noopener" class="post-url">Twitter</a>-->
<!--            </div>-->

<!--            <div  class="menuText">-->
<!--                <a href="https://github.com/MakinoharaShoko/hexo-OSX-theme" target="_blank" rel="noopener" class="post-url">Theme OS-X by Makinohara</a>-->
<!--            </div>-->
<!--            <div id="author" class="menuText">-->
<!--                <a href="/" class="post-url">©2020 MSFASR Centre Telecom</a>-->
<!--            </div>-->
<!--        </div><nbsp></nbsp></div>-->
<!--    <img src="/img/iconsTop.png" alt="icons"id="icons"/>-->
<!--    <div id="showtime"></div>-->

</div>

<!--now write body-->
<div id="body">
    
<link rel="stylesheet" href="/css/aside.css">


<div id="Content">
    <!-- 引入侧边栏 -->
    <div id="asidePart">
        <nav id="title-list-nav">
            
                <a  class="post-url"
                   href="/2022/08/27/2022-8-27-WebGAL3/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-08-27 18:30:00">2022/08/27</div>
                        <div class="post-title" title="WebGAL 年度总结">WebGAL 年度总结</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/05/29/2022-5-29-Webpack/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-05-29 18:30:00">2022/05/29</div>
                        <div class="post-title" title="Webpack 搭建 React + TS 环境">Webpack 搭建 React + TS 环境</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/05/27/2022-5-27-Authentication-in-NestJS/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-05-27 15:30:00">2022/05/27</div>
                        <div class="post-title" title="NestJS 认证与认证初步">NestJS 认证与认证初步</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/05/25/2022-5-25-Install-MySQL-By-Cli/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-05-25 23:30:00">2022/05/25</div>
                        <div class="post-title" title="MySQL installation by CLI">MySQL installation by CLI</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/05/19/2022-5-19-current-situation/"
                   data-tag="生活感想,工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-05-19 23:30:00">2022/05/19</div>
                        <div class="post-title" title="现状">现状</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/05/14/2022-5-14-sufferingSpring/"
                   data-tag="生活感想"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-05-14 23:30:00">2022/05/14</div>
                        <div class="post-title" title="我与春招与苦难之春">我与春招与苦难之春</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/05/10/2022-5-10-How-To-Refs/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-05-10 17:30:00">2022/05/10</div>
                        <div class="post-title" title="在 TS 中使用 Refs">在 TS 中使用 Refs</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/05/10/2022-5-10-Effective-Redux/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-05-10 17:00:00">2022/05/10</div>
                        <div class="post-title" title="Effective React Redux">Effective React Redux</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/04/08/2022-4-8-Wasm-2/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-04-08 23:00:00">2022/04/08</div>
                        <div class="post-title" title="WASM + Rust + WebWorker 实现计算器（">WASM + Rust + WebWorker 实现计算器（</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/04/06/2022-4-6-Wasm/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-04-06 23:00:00">2022/04/06</div>
                        <div class="post-title" title="WASM Rust 踩坑记（附完整解决方法">WASM Rust 踩坑记（附完整解决方法</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/03/03/2022-3-3-FE_Interview/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-03-03 23:00:00">2022/03/03</div>
                        <div class="post-title" title="前端面试知识点查缺补漏">前端面试知识点查缺补漏</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/03/03/2022-3-3-Socket/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-03-03 23:00:00">2022/03/03</div>
                        <div class="post-title" title="WebSocket 与 Socket.io 总结">WebSocket 与 Socket.io 总结</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/02/23/2022-2-23-CORS/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-02-23 23:00:00">2022/02/23</div>
                        <div class="post-title" title="有关跨域问题的知识点概述">有关跨域问题的知识点概述</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2022/02/11/2022-2-11-YouthCamp/"
                   data-tag="生活感想"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2022-02-11 23:00:00">2022/02/11</div>
                        <div class="post-title" title="关于参加字节跳动前端冬季青训营的总结">关于参加字节跳动前端冬季青训营的总结</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/12/18/2021-12-18-Redux1/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-12-18 12:00:01">2021/12/18</div>
                        <div class="post-title" title="Redux初体验">Redux初体验</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/12/14/2021-12-14-FE_List/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-12-14 12:00:01">2021/12/14</div>
                        <div class="post-title" title="前端学习拉清单">前端学习拉清单</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/11/02/2021-11-2-JavaScript2/"
                   data-tag="编程语言"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-11-02 08:00:00">2021/11/02</div>
                        <div class="post-title" title="JavaScript高级程序设计">JavaScript高级程序设计</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/10/24/2021-10-24-WG_3/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-10-24 12:00:01">2021/10/24</div>
                        <div class="post-title" title="记一次前端项目的踩坑与开发经验">记一次前端项目的踩坑与开发经验</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/09/27/2021-9-27-WG_1/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-09-27 12:00:01">2021/09/27</div>
                        <div class="post-title" title="WebGAL开发日志1：我如何打造一个网页版的Galgame游戏引擎">WebGAL开发日志1：我如何打造一个网页版的Galgame游戏引擎</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/09/17/2021-9-17-React/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-09-17 12:00:01">2021/09/17</div>
                        <div class="post-title" title="React">React</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/09/12/2021-9-12-nodeJs/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-09-12 12:00:01">2021/09/12</div>
                        <div class="post-title" title="Node.js">Node.js</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/08/03/2021-8-3-ML/"
                   data-tag="科研应用"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-08-03 12:00:01">2021/08/03</div>
                        <div class="post-title" title="机器学习">机器学习</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/07/09/2021-7-9-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%A4%8D%E4%B9%A0/"
                   data-tag="计算机基础"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-07-09 21:00:01">2021/07/09</div>
                        <div class="post-title" title="计算机组成复习">计算机组成复习</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/07/07/2021-7-7-%E6%B2%A1%E6%9C%89%E4%BB%80%E4%B9%88%E9%81%93%E5%BE%B7/"
                   data-tag="生活感想"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-07-07 16:00:01">2021/07/07</div>
                        <div class="post-title" title="没有什么道德">没有什么道德</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/07/06/2021-7-6-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/"
                   data-tag="计算机基础"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-07-06 21:00:01">2021/07/06</div>
                        <div class="post-title" title="操作系统复习">操作系统复习</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/07/01/2021-7-1-sql/"
                   data-tag="计算机基础"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-07-01 21:00:01">2021/07/01</div>
                        <div class="post-title" title="数据库复习">数据库复习</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/07/01/2021-7-1-TestLatex/"
                   data-tag="学习"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-07-01 12:00:01">2021/07/01</div>
                        <div class="post-title" title="测试公式输入">测试公式输入</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/06/30/2021-6-30-ZX/"
                   data-tag="生活感想"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-06-30 12:00:01">2021/06/30</div>
                        <div class="post-title" title="大学贰年自省录">大学贰年自省录</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/06/16/2021-6-16-CV/"
                   data-tag="科研应用"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-06-16 12:00:01">2021/06/16</div>
                        <div class="post-title" title="计算机视觉——入门">计算机视觉——入门</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2021/03/20/2021-3-23-Maven/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2021-03-20 12:00:00">2021/03/20</div>
                        <div class="post-title" title="Maven">Maven</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2020/05/08/2020-5-8-ASR-E1/"
                   data-tag="计算机基础"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2020-05-08 11:00:00">2020/05/08</div>
                        <div class="post-title" title="KMP算法详解">KMP算法详解</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2020/04/15/2020-3-24-Reduce/"
                   data-tag="生活感想"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2020-04-15 23:00:00">2020/04/15</div>
                        <div class="post-title" title="论手机是如何改变我们的思维方式的">论手机是如何改变我们的思维方式的</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2020/02/24/2020-2-24-HowToWeb/"
                   data-tag="生活感想,工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2020-02-24 14:00:00">2020/02/24</div>
                        <div class="post-title" title="如何成为Web工程师">如何成为Web工程师</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2020/02/18/2020-2-18-Web/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2020-02-18 09:00:00">2020/02/18</div>
                        <div class="post-title" title="Web开发基础">Web开发基础</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2020/02/17/2020-2-17-Data2/"
                   data-tag="计算机基础"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2020-02-17 16:13:00">2020/02/17</div>
                        <div class="post-title" title="数据结构2：树、散列、堆、图">数据结构2：树、散列、堆、图</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2020/02/17/2020-2-17-Algorithm/"
                   data-tag="计算机基础"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2020-02-17 16:13:00">2020/02/17</div>
                        <div class="post-title" title="算法分析（基础篇）">算法分析（基础篇）</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2020/02/17/2020-2-17-Data1/"
                   data-tag="计算机基础"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2020-02-17 16:13:00">2020/02/17</div>
                        <div class="post-title" title="数据结构1:表、栈和队列">数据结构1:表、栈和队列</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2020/02/16/2020-2-16-DevelopingTheme/"
                   data-tag="工程开发"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2020-02-16 13:13:00">2020/02/16</div>
                        <div class="post-title" title="开发自己的Hexo主题">开发自己的Hexo主题</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2020/01/20/2020-1-20-Programmer's%20advancement/"
                   data-tag="生活感想,计算机基础"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2020-01-20 23:13:00">2020/01/20</div>
                        <div class="post-title" title="(转载)程序员修炼之路">(转载)程序员修炼之路</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2019/12/27/2019-12-27-19End/"
                   data-tag="生活感想"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2019-12-27 23:13:00">2019/12/27</div>
                        <div class="post-title" title="To the end of 2019.">To the end of 2019.</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2019/11/26/2019-11-26-Linux/"
                   data-tag="计算机基础"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2019-11-26 08:00:00">2019/11/26</div>
                        <div class="post-title" title="How to use Linux">How to use Linux</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2019/11/19/2019-11-19-Cpp/"
                   data-tag="编程语言"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2019-11-19 16:00:00">2019/11/19</div>
                        <div class="post-title" title="C++语言学习笔记">C++语言学习笔记</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2019/11/12/2019-11-12-C/"
                   data-tag="编程语言"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2019-11-12 10:13:00">2019/11/12</div>
                        <div class="post-title" title="C Programing Language">C Programing Language</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2019/11/10/2019-11-10-SaveMaths/"
                   data-tag="学习"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2019-11-10 15:13:00">2019/11/10</div>
                        <div class="post-title" title="如何拯救我的数学">如何拯救我的数学</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2019/10/25/2019-10-25-Python/"
                   data-tag="编程语言"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2019-10-25 08:00:00">2019/10/25</div>
                        <div class="post-title" title="Developing in Python">Developing in Python</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2019/10/25/2019-10-25-Java/"
                   data-tag="编程语言"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2019-10-25 08:00:00">2019/10/25</div>
                        <div class="post-title" title="Developing in Java">Developing in Java</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2019/10/03/2019-10-03-Chinese%20Phone/"
                   data-tag="生活感想"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2019-10-03 12:00:00">2019/10/03</div>
                        <div class="post-title" title="重返国产机">重返国产机</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2019/09/30/2019-09-30-Hello%202019/"
                   data-tag="生活感想"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2019-09-30 12:00:00">2019/09/30</div>
                        <div class="post-title" title="Hello 2019">Hello 2019</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2019/09/30/2019-09-30-OneYearLater/"
                   data-tag="生活感想"
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2019-09-30 12:00:00">2019/09/30</div>
                        <div class="post-title" title="TO: YOU. ONE YEAR LATER">TO: YOU. ONE YEAR LATER</div>
                    </div>

                </a>
            
                <a  class="post-url"
                   href="/2019/08/20/About/"
                   data-tag=""
                   data-author="" >
                    <div class="post-box">

                        <div class="post-date" title="2019-08-20 21:59:02">2019/08/20</div>
                        <div class="post-title" title="About">About</div>
                    </div>

                </a>
            
        </nav>
    </div>

    <div id="content">

        <div class="ArticleHead">
            <div id="Showtags">
                
                    
                    
                        <a href='/tags/工程开发/'>
                            <div class="singleTag">
                                工程开发
                            </div>
                        </a>
                    
                
            </div>
            <br/>
            <br/>
            <br/>
            <div class="ArticleText">
                NestJS 认证与认证初步
            </div>
            <div class="ArticleTime">
                Published on Fri May 27 2022 15:30:00 GMT+0000
            </div>


        </div>
        <div id="article">
            <h2 id="Local-认证"><a href="#Local-认证" class="headerlink" title="Local 认证"></a>Local 认证</h2><h4 id="首先，准备包-Passport"><a href="#首先，准备包-Passport" class="headerlink" title="首先，准备包 Passport"></a>首先，准备包 Passport</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">yarn add @nestjs/passport passport passport-local<br>yarn add @types/passport-local<br></code></pre></td></tr></table></figure>

<h4 id="创建-Auth-模块和-User-模块"><a href="#创建-Auth-模块和-User-模块" class="headerlink" title="创建 Auth 模块和 User 模块"></a>创建 Auth 模块和 User 模块</h4><p><strong>UserService需要做什么？</strong></p>
<p>提供用户数据。</p>
<p>User模块的创建没有太多标准，只需要是一个单例，提供用户数据即可。在实际应用中应该再这里构建用户模型和持久层。</p>
<p>其中，User模块需要提供用户数据并提供方法来返回用户数据，并且需要在模块中导出。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Module &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;<br><span class="hljs-keyword">import</span> &#123; UsersService &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./users.service'</span>;<br><br><span class="hljs-meta">@Module</span>(&#123;<br>  providers: [UsersService],<br>  exports: [UsersService],<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> UsersModule &#123;&#125;<br></code></pre></td></tr></table></figure>

<p><strong>AuthService需要做什么？</strong></p>
<p><strong>提供认证的具体实现，提供JWT等……</strong></p>
<p>提供认证实现的一个例子：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Injectable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;<br><span class="hljs-keyword">import</span> &#123; UsersService &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../users/users.service'</span>;<br><br><span class="hljs-meta">@Injectable</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> AuthService &#123;<br>  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> readonly usersService: UsersService</span>) &#123;&#125;<br><br>  <span class="hljs-keyword">async</span> validateUser(username: <span class="hljs-built_in">string</span>, pass: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; &#123;<br>    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.usersService.findOne(username);<br>    <span class="hljs-keyword">if</span> (user &amp;&amp; user.password === pass) &#123;<br>      <span class="hljs-keyword">const</span> &#123; password, ...result &#125; = user;<br>      <span class="hljs-keyword">return</span> result;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>在实际的应用程序中，我们不会以纯文本形式存储密码。 取而代之的是使用带有加密单向哈希算法的 <code>bcrypt</code> 之类的库。</strong></p>
<p>Auth 模块需要导入用户模块和PassportModule，用于认证。</p>
<p>Auth 模块的Provider 是 AuthService 和 LocalStrategy（用于提供认证策略）。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Module &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;<br><span class="hljs-keyword">import</span> &#123; AuthService &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./auth.service'</span>;<br><span class="hljs-keyword">import</span> &#123; UsersModule &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../users/users.module'</span>;<br><span class="hljs-keyword">import</span> &#123; PassportModule &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/passport'</span>;<br><span class="hljs-keyword">import</span> &#123; LocalStrategy &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./local.strategy'</span>;<br><br><span class="hljs-meta">@Module</span>(&#123;<br>  imports: [UsersModule, PassportModule],<br>  providers: [AuthService, LocalStrategy],<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> AuthModule &#123;&#125;<br></code></pre></td></tr></table></figure>

<h4 id="实现策略"><a href="#实现策略" class="headerlink" title="实现策略"></a>实现策略</h4><p>在<code>local.strategy.ts</code> 中实现策略，策略的具体实现依赖于 AuthService</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Strategy &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'passport-local'</span>;<br><span class="hljs-keyword">import</span> &#123; PassportStrategy &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/passport'</span>;<br><span class="hljs-keyword">import</span> &#123; Injectable, UnauthorizedException &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;<br><span class="hljs-keyword">import</span> &#123; AuthService &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./auth.service'</span>;<br><br><span class="hljs-meta">@Injectable</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> LocalStrategy <span class="hljs-keyword">extends</span> PassportStrategy(Strategy) &#123;<br>  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> readonly authService: AuthService</span>) &#123;<br>    <span class="hljs-keyword">super</span>();<br>  &#125;<br><br>  <span class="hljs-keyword">async</span> validate(username: <span class="hljs-built_in">string</span>, password: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; &#123;<br>    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.authService.validateUser(username, password);<br>    <span class="hljs-keyword">if</span> (!user) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnauthorizedException();<br>    &#125;<br>    <span class="hljs-keyword">return</span> user;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="local-认证"><a href="#local-认证" class="headerlink" title="local 认证"></a>local 认证</h3><p><strong>别忘了导入 AuthModule ！</strong></p>
<p>在Controller 中引入 <code>@UseGuards</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Controller, Request, Post, UseGuards &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;<br><span class="hljs-keyword">import</span> &#123; AuthGuard &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/passport'</span>;<br><br><span class="hljs-meta">@Controller</span>(<span class="hljs-string">'testguard'</span>)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> TestguardController &#123;<br>  <span class="hljs-comment">// 在这里引入需要的认证守卫！</span><br>  <span class="hljs-meta">@UseGuards</span>(AuthGuard(<span class="hljs-string">'local'</span>))<br>  <span class="hljs-meta">@Post</span>(<span class="hljs-string">'auth/login'</span>)<br>  <span class="hljs-keyword">async</span> login(<span class="hljs-meta">@Request</span>() req) &#123;<br>    <span class="hljs-keyword">return</span> req.user;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>也可以将要使用的AuthGuard 写成一个类</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Injectable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;<br><span class="hljs-keyword">import</span> &#123; AuthGuard &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/passport'</span>;<br><br><span class="hljs-meta">@Injectable</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> LocalAuthGuard <span class="hljs-keyword">extends</span> AuthGuard(<span class="hljs-string">'local'</span>) &#123;&#125;<br></code></pre></td></tr></table></figure>

<p>引入方式变为 <code>@UseGuards(LocalAuthGuard)</code></p>
<h2 id="JWT-方式"><a href="#JWT-方式" class="headerlink" title="JWT 方式"></a>JWT 方式</h2><h3 id="JWT-生成"><a href="#JWT-生成" class="headerlink" title="JWT 生成"></a>JWT 生成</h3><h4 id="引入包"><a href="#引入包" class="headerlink" title="引入包"></a>引入包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">yarn add @nestjs/jwt passport-jwt<br>yarn add @types/passport-jwt<br></code></pre></td></tr></table></figure>

<h4 id="在-AuthService-中加上-JWT"><a href="#在-AuthService-中加上-JWT" class="headerlink" title="在 AuthService 中加上 JWT"></a>在 AuthService 中加上 JWT</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">constructor</span>(<span class="hljs-params"><br>    <span class="hljs-keyword">private</span> readonly usersService: UsersService,<br>    <span class="hljs-keyword">private</span> readonly jwtService: JwtService, <span class="hljs-comment">// 别忘了在这里实例化 JwtService</span><br>  </span>) &#123;&#125;<br><br><span class="hljs-keyword">async</span> login(user: <span class="hljs-built_in">any</span>) &#123;<br>    <span class="hljs-keyword">const</span> payload = &#123; username: user.username, sub: user.userId &#125;;<br>    <span class="hljs-keyword">return</span> &#123;<br>      access_token: <span class="hljs-keyword">this</span>.jwtService.sign(payload),<br>    &#125;;<br>  &#125;<br></code></pre></td></tr></table></figure>

<p>我们使用 <code>@nestjs/jwt</code> 库，该库提供了一个 <code>sign()</code> 函数，用于从用户对象属性的子集生成 <code>jwt</code>，然后以简单对象的形式返回一个 <code>access_token</code> 属性。注意:我们选择 <code>sub</code> 的属性名来保持我们的 <code>userId</code> 值与<code>JWT</code> 标准一致。不要忘记将 <code>JwtService</code> 提供者注入到 <code>AuthService</code>中。</p>
<p>我们使用 <code>register()</code> 配置 <code>JwtModule</code> ，并传入一个配置对象。</p>
<h4 id="修改-AuthService"><a href="#修改-AuthService" class="headerlink" title="修改 AuthService"></a>修改 AuthService</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Module</span>(&#123;<br>  imports: [<br>    UsersModule,<br>    PassportModule,<br>    JwtModule.register(&#123;<br>      secret: jwtConstants.secret,<br>      signOptions: &#123; expiresIn: <span class="hljs-string">'60s'</span> &#125;,<br>    &#125;),<br>  ],<br>  providers: [AuthService, LocalStrategy],<br>  exports: [AuthService],<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> AuthModule &#123;&#125;<br></code></pre></td></tr></table></figure>

<p>别忘了导出 <code>AuthService</code> 这样使用这个模块的Module 才能获取 <code>AuthService</code></p>
<h4 id="更新-Controller"><a href="#更新-Controller" class="headerlink" title="更新 Controller"></a>更新 Controller</h4><p>因为 Passport 定义的 <strong>所有策略</strong> 都是将validate() 方法执行的结果作为 user 属性存储在当前 <strong>HTTP Request 对象</strong> 上，所以我们可以得到 <code>username</code> 和 <code>userId</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Controller</span>(<span class="hljs-string">'testguard'</span>)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> TestguardController &#123;<br>  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> readonly authService: AuthService</span>) &#123;&#125;<br>  <span class="hljs-meta">@UseGuards</span>(LocalAuthGuard)<br>  <span class="hljs-meta">@Post</span>(<span class="hljs-string">'auth/login'</span>)<br>  <span class="hljs-keyword">async</span> login(<span class="hljs-meta">@Request</span>() req) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.authService.login(req.user);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这样，我们就能得到 <code>AccessToken</code>。</p>
<p><code>POST localhost:3000/testguard/auth/login</code></p>
<p>x-www-form-urlencoded:<code>username=john&amp;passwoed=changeme</code></p>
<p>返回：</p>
<figure class="highlight JSON"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JSON">&#123;<span class="hljs-attr">"access_token"</span>:<span class="hljs-string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImpvaG4iLCJzdWIiOjEsImlhdCI6MTY1MzY0MDUyMiwiZXhwIjoxNjUzNjQwNTgyfQ.gvMROxXrL_ywMDNf2IbReCxgrh6_FQYh10M34A8JxwM"</span>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="JWT-认证"><a href="#JWT-认证" class="headerlink" title="JWT 认证"></a>JWT 认证</h3><h4 id="编写-JWT-策略"><a href="#编写-JWT-策略" class="headerlink" title="编写 JWT 策略"></a>编写 JWT 策略</h4><p><code>auth/jwt.strategy.ts</code></p>
<p>对于 <code>JWT</code> 策略，<code>Passport</code> 首先验证 <code>JWT</code> 的签名并解码 <code>JSON </code>。然后调用我们的 <code>validate()</code> 方法，该方法将解码后的 <code>JSON</code> 作为其单个参数传递。</p>
<p>所以，实际上我们的 <code>validate</code> 是拿到了解码后的 <code>JSON</code>，这个 <code>payload</code> 正是我们之前通过 <code>sign</code> 生成的。</p>
<p>所以我们只需要返回其内容。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; ExtractJwt, Strategy &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'passport-jwt'</span>;<br><span class="hljs-keyword">import</span> &#123; PassportStrategy &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/passport'</span>;<br><span class="hljs-keyword">import</span> &#123; Injectable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;<br><span class="hljs-keyword">import</span> &#123; jwtConstants &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./constants'</span>;<br><br><span class="hljs-meta">@Injectable</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> JwtStrategy <span class="hljs-keyword">extends</span> PassportStrategy(Strategy) &#123;<br>  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">super</span>(&#123;<br>      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),<br>      ignoreExpiration: <span class="hljs-literal">false</span>,<br>      secretOrKey: jwtConstants.secret,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">async</span> validate(payload: <span class="hljs-built_in">any</span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123; userId: payload.sub, username: payload.username &#125;;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>在 <code>AuthModule</code> 中添加新的 <code>JwtStrategy</code> 作为提供者，因为现在我们提供了 JWT 作为认证方式</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Module</span>(&#123;<br>  imports: [<br>    UsersModule,<br>    PassportModule,<br>    JwtModule.register(&#123;<br>      secret: jwtConstants.secret,<br>      signOptions: &#123; expiresIn: <span class="hljs-string">'60s'</span> &#125;,<br>    &#125;),<br>  ],<br>  providers: [AuthService, LocalStrategy, JwtStrategy],<br>  exports: [AuthService],<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> AuthModule &#123;&#125;<br></code></pre></td></tr></table></figure>

<h4 id="然后，引入这个策略"><a href="#然后，引入这个策略" class="headerlink" title="然后，引入这个策略"></a>然后，引入这个策略</h4><p><code>jwt-auth.guard.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Injectable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;<br><span class="hljs-keyword">import</span> &#123; AuthGuard &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/passport'</span>;<br><br><span class="hljs-meta">@Injectable</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> JwtAuthGuard <span class="hljs-keyword">extends</span> AuthGuard(<span class="hljs-string">'jwt'</span>) &#123;&#125;<br></code></pre></td></tr></table></figure>

<h4 id="修改-Controller"><a href="#修改-Controller" class="headerlink" title="修改 Controller"></a>修改 Controller</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; Controller, Request, Post, UseGuards, Get &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;<br><span class="hljs-keyword">import</span> &#123; AuthService &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../auth/auth.service'</span>;<br><span class="hljs-keyword">import</span> &#123; LocalAuthGuard &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../auth/local-auth.guard'</span>;<br><span class="hljs-keyword">import</span> &#123; JwtAuthGuard &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../auth/jwt-auth.guard'</span>;<br><br><span class="hljs-meta">@Controller</span>(<span class="hljs-string">'testguard'</span>)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> TestguardController &#123;<br>  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> readonly authService: AuthService</span>) &#123;&#125;<br><br>  <span class="hljs-meta">@UseGuards</span>(LocalAuthGuard)<br>  <span class="hljs-meta">@Post</span>(<span class="hljs-string">'auth/login'</span>)<br>  <span class="hljs-keyword">async</span> login(<span class="hljs-meta">@Request</span>() req) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.authService.login(req.user);<br>  &#125;<br><br>  <span class="hljs-meta">@UseGuards</span>(JwtAuthGuard)<br>  <span class="hljs-meta">@Get</span>(<span class="hljs-string">'info'</span>)<br>  <span class="hljs-keyword">async</span> getInfo(<span class="hljs-meta">@Request</span>() req) &#123;<br>    <span class="hljs-keyword">return</span> req.user;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>在 Get 时加上 请求头</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">Authorization</span>: Bearer [<span class="hljs-keyword">Access</span> Token]<br></code></pre></td></tr></table></figure>

<p>即可访问被 <code>JwtAuthGuard</code> 保护的数据。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>实现认证总是需要编写以下模块：</p>
<p>1、<code>UserModule</code> ，作为用户数据的提供者（提供账号密码等）</p>
<p>2、<code>AuthModule</code>，用于提供认证策略，实现认证服务。</p>
<h3 id="UserModule-需要编写什么？"><a href="#UserModule-需要编写什么？" class="headerlink" title="UserModule 需要编写什么？"></a>UserModule 需要编写什么？</h3><h4 id="UserService"><a href="#UserService" class="headerlink" title="UserService"></a>UserService</h4><p>获取用户数据的逻辑，<strong>这个模块需要导出并由<code>AuthService</code>引入</strong>。</p>
<h3 id="AuthModule-需要编写什么？"><a href="#AuthModule-需要编写什么？" class="headerlink" title="AuthModule 需要编写什么？"></a>AuthModule 需要编写什么？</h3><h4 id="AuthService"><a href="#AuthService" class="headerlink" title="AuthService"></a>AuthService</h4><p>这个服务用于：具体实现local认证（因为密码可能散列），生成<code>JWT</code>（一般来说在生成<code>JWT</code>前已经由Local认证，并得到用户信息，这时候根据用户信息来生成<code>JWT</code>）</p>
<p>这个服务需要导入：<code>UserSercice</code>（用于Local认证），<code>JwtService</code>（用于生成<code>JWT</code>）</p>
<h4 id="AuthModule"><a href="#AuthModule" class="headerlink" title="AuthModule"></a>AuthModule</h4><p>需要导入的：<code>UserModule</code>（用于让Service可以拿到用户数据）、<code>PassportModule</code> （我们实现认证的库）、<code>JWTModule</code>（用于生成<code>JWT</code>，并配置<code>JWT</code>参数）</p>
<p>这个模块的提供者：<code>AuthService</code>（提供认证具体实现）、<code>LocalStrategy</code>， <code>JwtStrategy</code>（具体策略）</p>
<p>需要导出的：<code>AuthService</code>（为什么？因为我们需要这个服务来生成<code>JWT</code>，Controller 需要这个服务来获得 <code>JWT</code>并响应。</p>
<h4 id="编写策略"><a href="#编写策略" class="headerlink" title="编写策略"></a>编写策略</h4><p>所有的策略都是继承 <code>PassportStrategy(Strategy)</code>，实现 <code>validate</code> 方法。</p>
<p><code>validate</code> 方法总是接受来自 <code>req</code> 的属性，返回的属性也会附加到 <code>req</code> 。一旦认证结束后，我们就可以从 <code>req</code>对象中拿到认证的结果。</p>
<p>策略的核心在于在发生错误的时候抛出 <code>UnauthorizedException()</code> 来告知无法认证，在认证通过的时候往 <code>req</code>对象上附加一些属性（这些属性可以用于返回，也可以用于生成 <code>JWT</code>）。</p>
<p>策略会调用 <code>AuthService</code> ，因为那里有认证的具体实现。</p>
<h4 id="收尾"><a href="#收尾" class="headerlink" title="收尾"></a>收尾</h4><p>可以导出 <code>jwt-auth.guard.ts</code>、  <code>local-auth.guard.ts</code> 简化在Controller 使用 <code>@UseGuards</code>注解时要编写的代码。</p>

        </div>

    </div>


</div>

</div>

<!--Now Write Bottom -->
<!--
 <div id="Bottom">
    <a href="/">
        <img src="/img/mail.png" class="BottomImg" >
    </a>
    <a href="/tags/BigNotes">
        <img src="/img/missioncontrol.png" class="BottomImg">
    </a>
    <a href="/archives">
        <img src="/img/reminders.png" class="BottomImg">
    </a>
    <a href="/photos">
        <img src="/img/preview.png" class="BottomImg">
    </a>




</div>
-->





<script src="/js/osx.js"></script>

</body>
</html>
